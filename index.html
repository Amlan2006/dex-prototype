<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RayVerse DEX</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.7.1/ethers.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #16213e 100%);
            color: #ffffff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 40px;
            padding: 20px 0;
        }

        .logo {
            font-size: 2rem;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .wallet-connect {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            padding: 12px 24px;
            border-radius: 12px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .wallet-connect:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 40px;
        }

        .card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 2px;
            background: linear-gradient(90deg, transparent, #667eea, transparent);
            transition: left 0.5s;
        }

        .card:hover::before {
            left: 100%;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
        }

        .card-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 25px;
            text-align: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .input-group {
            margin-bottom: 20px;
            position: relative;
        }

        .input-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #b0b0b0;
        }

        .input-field {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 15px 20px;
            color: white;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .input-field:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 20px rgba(102, 126, 234, 0.3);
            transform: scale(1.02);
        }

        .btn {
            width: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 12px;
            padding: 15px 30px;
            color: white;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .btn::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }

        .btn:hover::before {
            width: 300px;
            height: 300px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.4);
        }

        .btn span {
            position: relative;
            z-index: 1;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 40px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 25px;
            text-align: center;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            border-color: rgba(102, 126, 234, 0.5);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 8px;
        }

        .stat-label {
            color: #b0b0b0;
            font-weight: 500;
        }

        .toggle-buttons {
            display: flex;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 4px;
            margin-bottom: 25px;
        }

        .toggle-btn {
            flex: 1;
            background: transparent;
            border: none;
            color: #b0b0b0;
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .toggle-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 15px 25px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transform: translateX(400px);
            transition: transform 0.3s ease;
            z-index: 1000;
            max-width: 350px;
        }

        .notification.show {
            transform: translateX(0);
        }

        .loading {
            display: none;
            width: 20px;
            height: 20px;
            border: 2px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .price-display {
            background: rgba(102, 126, 234, 0.1);
            border: 1px solid rgba(102, 126, 234, 0.3);
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            text-align: center;
            font-weight: 600;
            color: #667eea;
        }

        .balance-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 10px 0;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }

        .balance-label {
            color: #b0b0b0;
            font-size: 14px;
        }

        .balance-value {
            color: #667eea;
            font-weight: 600;
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                gap: 20px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }

        .floating-particles {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
        }

        .particle {
            position: absolute;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 50%;
            animation: float 20s infinite linear;
        }

        @keyframes float {
            0% {
                transform: translateY(100vh) translateX(0px) rotate(0deg);
                opacity: 0;
            }
            10% {
                opacity: 1;
            }
            90% {
                opacity: 1;
            }
            100% {
                transform: translateY(-100vh) translateX(100px) rotate(360deg);
                opacity: 0;
            }
        }
    </style>
</head>
<body>
    <div class="floating-particles"></div>
    
    <div class="container">
        <header class="header">
            <div class="logo">RayVerse DEX</div>
            <button class="wallet-connect" onclick="connectWallet()">
                <span id="wallet-text">Connect Wallet</span>
            </button>
        </header>

        <div class="main-content">
            <!-- Trading Card -->
            <div class="card">
                <h2 class="card-title">Trade</h2>
                
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="setTradeMode('swap')">Swap</button>
                    <button class="toggle-btn" onclick="setTradeMode('price')">Price Check</button>
                </div>

                <div id="swap-interface">
                    <div class="input-group">
                        <label class="input-label" style="background-color: black;">From</label>
                        <select class="input-field" id="from-token" onchange="updateSwapDirection()">
                            <option value="rayverse">Rayverse (RAY)</option>
                            <option value="sonartaka">SonarTaka (STK)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Amount</label>
                        <input type="number" class="input-field" id="swap-amount" placeholder="Enter amount" oninput="updatePricePreview()">
                    </div>

                    <div class="price-display" id="price-preview">
                        Enter amount to see price
                    </div>

                    <button class="btn" onclick="executeSwap()">
                        <div class="loading" id="swap-loading"></div>
                        <span id="swap-btn-text">Swap Tokens</span>
                    </button>
                </div>
            </div>

            <!-- Liquidity Card -->
            <div class="card">
                <h2 class="card-title">Liquidity</h2>
                
                <div class="toggle-buttons">
                    <button class="toggle-btn active" onclick="setLiquidityMode('add')">Add</button>
                    <button class="toggle-btn" onclick="setLiquidityMode('remove')">Remove</button>
                </div>

                <div id="liquidity-interface">
                    <div class="input-group">
                        <label class="input-label">Token</label>
                        <select class="input-field" id="liquidity-token">
                            <option value="rayverse">Rayverse (RAY)</option>
                            <option value="sonartaka">SonarTaka (STK)</option>
                        </select>
                    </div>

                    <div class="input-group">
                        <label class="input-label">Amount</label>
                        <input type="number" class="input-field" id="liquidity-amount" placeholder="Enter amount">
                    </div>

                    <div class="balance-info">
                        <span class="balance-label">Your LP Shares:</span>
                        <span class="balance-value" id="lp-shares">0%</span>
                    </div>

                    <button class="btn" onclick="executeLiquidity()">
                        <div class="loading" id="liquidity-loading"></div>
                        <span id="liquidity-btn-text">Add Liquidity</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- Initialize Pool Card -->
        <div class="card" style="margin-bottom: 40px;">
            <h2 class="card-title">Initialize Pool</h2>
            
            <div class="input-group">
                <label class="input-label">Rayverse Amount</label>
                <input type="number" class="input-field" id="init-rayverse" placeholder="Enter Rayverse amount">
            </div>

            <div class="input-group">
                <label class="input-label">SonarTaka Amount</label>
                <input type="number" class="input-field" id="init-sonartaka" placeholder="Enter SonarTaka amount">
            </div>

            <button class="btn" onclick="initializePool()">
                <div class="loading" id="init-loading"></div>
                <span id="init-btn-text">Initialize Pool</span>
            </button>
        </div>

        <!-- Fee Collection Card -->
        <div class="card" style="margin-bottom: 40px;">
            <h2 class="card-title">Collect Fees</h2>
            <p style="text-align: center; color: #b0b0b0; margin-bottom: 25px;">
                Claim your share of trading fees as a liquidity provider
            </p>
            
            <div class="balance-info">
                <span class="balance-label">Available Rayverse Fees:</span>
                <span class="balance-value" id="available-ray-fees">0 RAY</span>
            </div>
            
            <div class="balance-info">
                <span class="balance-label">Available SonarTaka Fees:</span>
                <span class="balance-value" id="available-stk-fees">0 STK</span>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 20px;">
                <button class="btn" onclick="collectFees('rayverse')" style="flex: 1;">
                    <div class="loading" id="ray-fees-loading"></div>
                    <span id="ray-fees-btn-text">Collect RAY Fees</span>
                </button>
                
                <button class="btn" onclick="collectFees('sonartaka')" style="flex: 1;">
                    <div class="loading" id="stk-fees-loading"></div>
                    <span id="stk-fees-btn-text">Collect STK Fees</span>
                </button>
            </div>
        </div>

        <!-- Statistics -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-value" id="ray-liquidity">0</div>
                <div class="stat-label">Rayverse Liquidity</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stk-liquidity">0</div>
                <div class="stat-label">SonarTaka Liquidity</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ray-balance">0</div>
                <div class="stat-label">Your Rayverse</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stk-balance">0</div>
                <div class="stat-label">Your SonarTaka</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="ray-provided">0</div>
                <div class="stat-label">RAY Liquidity Provided</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="stk-provided">0</div>
                <div class="stat-label">STK Liquidity Provided</div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Contract configuration
        const CONTRACT_ADDRESS = "0x057ef64E23666F000b34aE31332854aCBd1c8544"; // Add your deployed contract address
        const CONTRACT_ABI = [
            
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "constructor"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "token",
                            "type": "address"
                        }
                    ],
                    "type": "error",
                    "name": "SafeERC20FailedOperation"
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "LPsharesInPoolRayverse",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "LPsharesInPoolSonarTaka",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "addLiquidityForRayverse"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "addLiquidityForSonarTaka"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "checkPriceRayverseToSonarTaka",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "checkPriceSonarTakaToRayverse",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "checkRayverseBalance",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "checkRayverseLiquidity",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "checkSonarTakaBalance",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "checkSonarTakaLiquidity",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "feesVaultRayverse",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "feesVaultSonarTaka",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "payable",
                    "type": "function",
                    "name": "getSomeBalance"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "_rayverseAmount",
                            "type": "uint256"
                        },
                        {
                            "internalType": "uint256",
                            "name": "_sonarTakaAmount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "initializeLiquidity"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "liquidityProvidersRAY",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "lpProviders",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "liquidityProvidersRayverse",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "rayverseamount",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "liquidityProvidersSTK",
                    "outputs": [
                        {
                            "internalType": "address",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "lpProviders",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "liquidityProvidersSonarTaka",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "sonarTakaAmount",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "rayVerseFeesAmount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "rayverse",
                    "outputs": [
                        {
                            "internalType": "contract Rayverse",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "rayverseLiquidity",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "recieveFeesRayverse",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "recieveFeesSonarTaka",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "removeLiquidityForRayverse"
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "removeLiquidityForSonarTaka"
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "sonarTaka",
                    "outputs": [
                        {
                            "internalType": "contract SonarTaka",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "sonarTakaFeesAmount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "sonarTakaLiquidity",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "swapRayverseToSonarTaka",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "uint256",
                            "name": "amount",
                            "type": "uint256"
                        }
                    ],
                    "stateMutability": "nonpayable",
                    "type": "function",
                    "name": "swapSonarTakaToRayverse",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "tokenA",
                    "outputs": [
                        {
                            "internalType": "contract IERC20",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "tokenB",
                    "outputs": [
                        {
                            "internalType": "contract IERC20",
                            "name": "",
                            "type": "address"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "userToRayverseAmount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "rayverseamount",
                            "type": "uint256"
                        }
                    ]
                },
                {
                    "inputs": [
                        {
                            "internalType": "address",
                            "name": "user",
                            "type": "address"
                        }
                    ],
                    "stateMutability": "view",
                    "type": "function",
                    "name": "userToSonarTakaAmount",
                    "outputs": [
                        {
                            "internalType": "uint256",
                            "name": "sonarTakaAmount",
                            "type": "uint256"
                        }
                    ]
                }
            
        ];
        let provider, signer, contract, userAddress;
        let currentTradeMode = 'swap';
        let currentLiquidityMode = 'add';

        // Initialize particles
        function createParticles() {
            const particleContainer = document.querySelector('.floating-particles');
            for (let i = 0; i < 20; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                particle.style.left = Math.random() * 100 + 'vw';
                particle.style.width = particle.style.height = Math.random() * 10 + 5 + 'px';
                particle.style.animationDelay = Math.random() * 20 + 's';
                particle.style.animationDuration = (Math.random() * 10 + 15) + 's';
                particleContainer.appendChild(particle);
            }
        }

        // Connect wallet
        async function connectWallet() {
            try {
                if (typeof window.ethereum !== 'undefined') {
                    provider = new ethers.BrowserProvider(window.ethereum);
                    await window.ethereum.request({ method: 'eth_requestAccounts' });
                    signer = await provider.getSigner();
                    userAddress = await signer.getAddress();
                    contract = new ethers.Contract(CONTRACT_ADDRESS, CONTRACT_ABI, signer);
                    
                    document.getElementById('wallet-text').textContent = 
                        `${userAddress.substring(0, 6)}...${userAddress.substring(38)}`;
                    
                    showNotification('Wallet connected successfully!');
                    await updateAllData();
                } else {
                    showNotification('Please install MetaMask!', 'error');
                }
            } catch (error) {
                console.error('Error connecting wallet:', error);
                showNotification('Failed to connect wallet!', 'error');
            }
        }

        // Show notification
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // Set trade mode
        function setTradeMode(mode) {
            currentTradeMode = mode;
            document.querySelectorAll('.toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
        }

        // Set liquidity mode
        function setLiquidityMode(mode) {
            currentLiquidityMode = mode;
            document.querySelectorAll('#liquidity-interface .toggle-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.getElementById('liquidity-btn-text').textContent = 
                mode === 'add' ? 'Add Liquidity' : 'Remove Liquidity';
        }

        // Update swap direction
        function updateSwapDirection() {
            updatePricePreview();
        }

        // Update price preview
        async function updatePricePreview() {
            const amount = document.getElementById('swap-amount').value;
            const fromToken = document.getElementById('from-token').value;
            const preview = document.getElementById('price-preview');
            
            if (!amount || !contract) {
                preview.textContent = 'Enter amount to see price';
                return;
            }

            try {
                let outputAmount;
                if (fromToken === 'rayverse') {
                    outputAmount = await contract.checkPriceRayverseToSonarTaka(amount);
                } else {
                    outputAmount = await contract.checkPriceSonarTakaToRayverse(amount);
                }
                
                const formattedOutput = ethers.formatEther(outputAmount);
                const toToken = fromToken === 'rayverse' ? 'SonarTaka' : 'Rayverse';
                preview.textContent = `≈ ${parseFloat(formattedOutput).toFixed(4)} ${toToken}`;
            } catch (error) {
                preview.textContent = 'Unable to calculate price';
            }
        }

        // Execute swap
        async function executeSwap() {
    if (!contract) {
        showNotification('Please connect your wallet first!', 'error');
        return;
    }

    const amount = document.getElementById('swap-amount').value;
    const fromToken = document.getElementById('from-token').value;
    
    if (!amount) {
        showNotification('Please enter an amount!', 'error');
        return;
    }

    const loading = document.getElementById('swap-loading');
    const btnText = document.getElementById('swap-btn-text');
    
    loading.style.display = 'block';
    btnText.textContent = 'Swapping...';

    try {
        const amountWei = ethers.parseEther(amount);
        const contractAddress = await contract.getAddress();
        let tx;
        
        if (fromToken === 'rayverse') {
            // Get the Rayverse token contract
            const rayverseAddress = await contract.tokenA();
            const rayverseContract = new ethers.Contract(
                rayverseAddress,
                [
                    'function approve(address spender, uint256 amount) returns (bool)',
                    'function allowance(address owner, address spender) view returns (uint256)'
                ],
                signer
            );
            
            // Check current allowance
            const userAddress = await signer.getAddress();
            const currentAllowance = await rayverseContract.allowance(userAddress, contractAddress);
            
            // Only approve if current allowance is insufficient
            if (currentAllowance < amountWei) {
                btnText.textContent = 'Approving tokens...';
                // Approve a larger amount to reduce future approval transactions
                const largeAmount = ethers.parseEther("1000000"); // 1M tokens
                const approveTx = await rayverseContract.approve(contractAddress, largeAmount);
                await approveTx.wait();
            }
            
            // Now execute the swap
            btnText.textContent = 'Swapping...';
            tx = await contract.swapRayverseToSonarTaka(amount);
        } else {
            // Get the SonarTaka token contract
            const sonarTakaAddress = await contract.tokenB();
            const sonarTakaContract = new ethers.Contract(
                sonarTakaAddress,
                [
                    'function approve(address spender, uint256 amount) returns (bool)',
                    'function allowance(address owner, address spender) view returns (uint256)'
                ],
                signer
            );
            
            // Check current allowance
            const userAddress = await signer.getAddress();
            const currentAllowance = await sonarTakaContract.allowance(userAddress, contractAddress);
            
            // Only approve if current allowance is insufficient
            if (currentAllowance < amountWei) {
                btnText.textContent = 'Approving tokens...';
                // Approve a larger amount to reduce future approval transactions
                const largeAmount = ethers.parseEther("1000000"); // 1M tokens
                const approveTx = await sonarTakaContract.approve(contractAddress, largeAmount);
                await approveTx.wait();
            }
            
            // Now execute the swap
            btnText.textContent = 'Swapping...';
            tx = await contract.swapSonarTakaToRayverse(amount);
        }
        
        await tx.wait();
        showNotification('Swap completed successfully!');
        await updateAllData();
        document.getElementById('swap-amount').value = '';
        document.getElementById('price-preview').textContent = 'Enter amount to see price';
    } catch (error) {
        console.error('Swap failed:', error);
        
        // More detailed error handling
        if (error.reason) {
            showNotification(`Swap failed: ${error.reason}`, 'error');
        } else if (error.message.includes('insufficient funds')) {
            showNotification('Insufficient funds for transaction!', 'error');
        } else if (error.message.includes('user rejected')) {
            showNotification('Transaction rejected by user!', 'error');
        } else if (error.message.includes('Insufficient liquidity')) {
            showNotification('Insufficient liquidity in the pool!', 'error');
        } else if (error.message.includes('Pool not initialized')) {
            showNotification('Liquidity pool not initialized!', 'error');
        } else {
            showNotification('Swap failed!', 'error');
        }
    } finally {
        loading.style.display = 'none';
        btnText.textContent = 'Swap Tokens';
    }
}

// Helper function to check and approve tokens if needed
async function ensureTokenApproval(tokenContract, contractAddress, amountNeeded) {
    const userAddress = await signer.getAddress();
    const currentAllowance = await tokenContract.allowance(userAddress, contractAddress);
    
    if (currentAllowance < amountNeeded) {
        // Approve a larger amount to reduce future approval transactions
        const largeAmount = ethers.parseEther("1000000");
        const approveTx = await tokenContract.approve(contractAddress, largeAmount);
        await approveTx.wait();
        return true; // Approval was needed and executed
    }
    return false; // No approval needed
}

        // Execute liquidity operation
        async function executeLiquidity() {
    if (!contract) {
        showNotification('Please connect your wallet first!', 'error');
        return;
    }

    const amount = document.getElementById('liquidity-amount').value;
    const token = document.getElementById('liquidity-token').value;
    
    if (!amount) {
        showNotification('Please enter an amount!', 'error');
        return;
    }

    const loading = document.getElementById('liquidity-loading');
    const btnText = document.getElementById('liquidity-btn-text');
    
    loading.style.display = 'block';
    btnText.textContent = currentLiquidityMode === 'add' ? 'Adding...' : 'Removing...';

    try {
        let tx;
        if (currentLiquidityMode === 'add') {
            // First, we need to approve the DEX contract to spend tokens
            const amountWei = ethers.parseEther(amount);
            
            if (token === 'rayverse') {
                // Get the Rayverse token contract
                const rayverseAddress = await contract.tokenA();
                const rayverseContract = new ethers.Contract(
                    rayverseAddress,
                    ['function approve(address spender, uint256 amount) returns (bool)'],
                    signer
                );
                
                // Approve the DEX to spend tokens
                btnText.textContent = 'Approving tokens...';
                const approveTx = await rayverseContract.approve(await contract.getAddress(), amountWei);
                await approveTx.wait();
                
                // Now add liquidity
                btnText.textContent = 'Adding liquidity...';
                tx = await contract.addLiquidityForRayverse(amount);
            } else {
                // Get the SonarTaka token contract
                const sonarTakaAddress = await contract.tokenB();
                const sonarTakaContract = new ethers.Contract(
                    sonarTakaAddress,
                    ['function approve(address spender, uint256 amount) returns (bool)'],
                    signer
                );
                
                // Approve the DEX to spend tokens
                btnText.textContent = 'Approving tokens...';
                const approveTx = await sonarTakaContract.approve(await contract.getAddress(), amountWei);
                await approveTx.wait();
                
                // Now add liquidity
                btnText.textContent = 'Adding liquidity...';
                tx = await contract.addLiquidityForSonarTaka(amount);
            }
        } else {
            if (token === 'rayverse') {
                tx = await contract.removeLiquidityForRayverse(amount);
            } else {
                tx = await contract.removeLiquidityForSonarTaka(amount);
            }
        }
        
        await tx.wait();
        showNotification(`Liquidity ${currentLiquidityMode}ed successfully!`);
        await updateAllData();
        document.getElementById('liquidity-amount').value = '';
    } catch (error) {
        console.error('Liquidity operation failed:', error);
        
        // More detailed error handling
        if (error.reason) {
            showNotification(`Operation failed: ${error.reason}`, 'error');
        } else if (error.message.includes('insufficient funds')) {
            showNotification('Insufficient funds for transaction!', 'error');
        } else if (error.message.includes('user rejected')) {
            showNotification('Transaction rejected by user!', 'error');
        } else {
            showNotification('Liquidity operation failed!', 'error');
        }
    } finally {
        loading.style.display = 'none';
        btnText.textContent = currentLiquidityMode === 'add' ? 'Add Liquidity' : 'Remove Liquidity';
    }
}
        // Initialize pool
        async function initializePool() {
            if (!contract) {
                showNotification('Please connect your wallet first!', 'error');
                return;
            }

            const rayAmount = document.getElementById('init-rayverse').value;
            const stkAmount = document.getElementById('init-sonartaka').value;
            
            if (!rayAmount || !stkAmount) {
                showNotification('Please enter both amounts!', 'error');
                return;
            }

            const loading = document.getElementById('init-loading');
            const btnText = document.getElementById('init-btn-text');
            
            loading.style.display = 'block';
            btnText.textContent = 'Initializing...';

            try {
                const tx = await contract.initializeLiquidity(rayAmount, stkAmount);
                await tx.wait();
                showNotification('Pool initialized successfully!');
                await updateAllData();
                document.getElementById('init-rayverse').value = '';
                document.getElementById('init-sonartaka').value = '';
            } catch (error) {
                console.error('Pool initialization failed:', error);
                showNotification('Pool initialization failed!', 'error');
            } finally {
                loading.style.display = 'none';
                btnText.textContent = 'Initialize Pool';
            }
        }

        // Get some balance (test function)
        async function getSomeBalance() {
            if (!contract) {
                showNotification('Please connect your wallet first!', 'error');
                return;
            }

            try {
                const tx = await contract.getSomeBalance();
                await tx.wait();
                showNotification('Test tokens received!');
                await updateAllData();
            } catch (error) {
                console.error('Get balance failed:', error);
                showNotification('Failed to get test tokens!', 'error');
            }
        }

        // Collect fees
        // Updated updateAllData function with fee display
async function updateAllData() {
    if (!contract || !userAddress) return;

    try {
        // Update liquidity stats
        const rayLiquidity = await contract.checkRayverseLiquidity();
        const stkLiquidity = await contract.checkSonarTakaLiquidity();
        
        document.getElementById('ray-liquidity').textContent = 
            parseFloat(ethers.formatEther(rayLiquidity)).toFixed(2);
        document.getElementById('stk-liquidity').textContent = 
            parseFloat(ethers.formatEther(stkLiquidity)).toFixed(2);

        // Update user balances
        const rayBalance = await contract.checkRayverseBalance(userAddress);
        const stkBalance = await contract.checkSonarTakaBalance(userAddress);
        
        document.getElementById('ray-balance').textContent = 
            parseFloat(ethers.formatEther(rayBalance)).toFixed(2);
        document.getElementById('stk-balance').textContent = 
            parseFloat(ethers.formatEther(stkBalance)).toFixed(2);

        // Update user provided liquidity amounts
        try {
            const userRayLiquidity = await contract.liquidityProvidersRayverse(userAddress);
            const userStkLiquidity = await contract.liquidityProvidersSonarTaka(userAddress);
            
            document.getElementById('ray-provided').textContent = 
                parseFloat(ethers.formatEther(userRayLiquidity)).toFixed(2);
            document.getElementById('stk-provided').textContent = 
                parseFloat(ethers.formatEther(userStkLiquidity)).toFixed(2);
        } catch (error) {
            document.getElementById('ray-provided').textContent = '0';
            document.getElementById('stk-provided').textContent = '0';
        }

        // Update LP shares
        try {
            const rayShares = await contract.LPsharesInPoolRayverse(userAddress);
            const stkShares = await contract.LPsharesInPoolSonarTaka(userAddress);
            
            const raySharesFormatted = parseFloat(ethers.formatEther(rayShares)).toFixed(2);
            const stkSharesFormatted = parseFloat(ethers.formatEther(stkShares)).toFixed(2);
            
            document.getElementById('lp-shares').textContent = 
                `RAY: ${raySharesFormatted}% | STK: ${stkSharesFormatted}%`;
        } catch (error) {
            document.getElementById('lp-shares').textContent = 'RAY: 0% | STK: 0%';
        }

        // Update available fees
        await updateAvailableFees();

    } catch (error) {
        console.error('Error updating data:', error);
    }
}

// New function to calculate and display available fees
async function updateAvailableFees() {
    if (!contract || !userAddress) return;

    try {
        // Get total fee amounts from the contract
        const totalRayFees = await contract.rayVerseFeesAmount();
        const totalStkFees = await contract.sonarTakaFeesAmount();
        
        // Calculate user's share of fees based on their LP shares
        let userRayFees = 0;
        let userStkFees = 0;
        
        try {
            // Check if user has LP shares to avoid revert
            const userRayLiquidity = await contract.liquidityProvidersRayverse(userAddress);
            const userStkLiquidity = await contract.liquidityProvidersSonarTaka(userAddress);
            
            if (userRayLiquidity > 0) {
                const rayShares = await contract.LPsharesInPoolRayverse(userAddress);
                // Calculate user's share: (userShares / 100) * totalFees
                userRayFees = (parseFloat(ethers.formatEther(rayShares)) / 100) * parseFloat(ethers.formatEther(totalRayFees));
            }
            
            if (userStkLiquidity > 0) {
                const stkShares = await contract.LPsharesInPoolSonarTaka(userAddress);
                // Calculate user's share: (userShares / 100) * totalFees  
                userStkFees = (parseFloat(ethers.formatEther(stkShares)) / 100) * parseFloat(ethers.formatEther(totalStkFees));
            }
        } catch (error) {
            // User has no LP shares, fees remain 0
            console.log('User has no LP shares:', error.message);
        }

        // Update the UI
        document.getElementById('available-ray-fees').textContent = `${userRayFees.toFixed(4)} RAY`;
        document.getElementById('available-stk-fees').textContent = `${userStkFees.toFixed(4)} STK`;
        
        // Optional: Show total pool fees for reference (you can add this to your HTML)
        console.log(`Total pool fees - RAY: ${parseFloat(ethers.formatEther(totalRayFees)).toFixed(4)}, STK: ${parseFloat(ethers.formatEther(totalStkFees)).toFixed(4)}`);
        
    } catch (error) {
        console.error('Error updating available fees:', error);
        document.getElementById('available-ray-fees').textContent = '0 RAY';
        document.getElementById('available-stk-fees').textContent = '0 STK';
    }
}

// Enhanced collectFees function that also updates the display
async function collectFees(tokenType) {
    if (!contract) {
        showNotification('Please connect your wallet first!', 'error');
        return;
    }

    const loadingId = tokenType === 'rayverse' ? 'ray-fees-loading' : 'stk-fees-loading';
    const btnTextId = tokenType === 'rayverse' ? 'ray-fees-btn-text' : 'stk-fees-btn-text';
    const loading = document.getElementById(loadingId);
    const btnText = document.getElementById(btnTextId);
    
    loading.style.display = 'block';
    btnText.textContent = 'Collecting...';

    try {
        // Check if user has LP shares before attempting to collect fees
        const userShares = tokenType === 'rayverse' 
            ? await contract.LPsharesInPoolRayverse(userAddress)
            : await contract.LPsharesInPoolSonarTaka(userAddress);

        if (userShares == 0) {
            showNotification(`You have no liquidity pool shares in ${tokenType === 'rayverse' ? 'Rayverse' : 'SonarTaka'} pool!`, 'error');
            return;
        }

        // Check if there are fees to collect
        const totalFees = tokenType === 'rayverse' 
            ? await contract.rayVerseFeesAmount()
            : await contract.sonarTakaFeesAmount();
            
        if (totalFees ==0) {
            showNotification('No fees available to collect at this time!', 'error');
            return;
        }

        let tx;
        if (tokenType === 'rayverse') {
            // Estimate gas first
            try {
                const gasEstimate = await contract.recieveFeesRayverse.estimateGas();
                tx = await contract.recieveFeesRayverse({ 
                    gasLimit: gasEstimate * 120n / 100n // 20% buffer
                });
            } catch (gasError) {
                // Fallback without gas estimation
                tx = await contract.recieveFeesRayverse();
            }
        } else {
            // Estimate gas first
            try {
                const gasEstimate = await contract.recieveFeesSonarTaka.estimateGas();
                tx = await contract.recieveFeesSonarTaka({ 
                    gasLimit: gasEstimate * 120n / 100n // 20% buffer
                });
            } catch (gasError) {
                // Fallback without gas estimation
                tx = await contract.recieveFeesSonarTaka();
            }
        }
        
        // Update button text to show waiting for confirmation
        btnText.textContent = 'Confirming...';
        
        const receipt = await tx.wait();
        
        // Get the amount collected from the transaction receipt
        const tokenName = tokenType === 'rayverse' ? 'Rayverse' : 'SonarTaka';
        showNotification(`${tokenName} fees collected successfully!`, 'success');
        
        // Update all data to reflect the changes
        await updateAllData();
        
    } catch (error) {
        console.error('Fee collection failed:', error);
        
        // Parse the error message for better user feedback
        const errorMessage = error.reason || error.message || error.toString();
        
        if (errorMessage.includes('No liquidity')) {
            showNotification(`No liquidity available in ${tokenType === 'rayverse' ? 'Rayverse' : 'SonarTaka'} pool!`, 'error');
        } else if (errorMessage.includes('No fees to collect')) {
            showNotification('No fees available to collect at this time!', 'error');
        } else if (errorMessage.includes('user rejected') || errorMessage.includes('User denied') || errorMessage.includes('rejected')) {
            showNotification('Transaction cancelled by user.', 'error');
        } else if (errorMessage.includes('insufficient funds') || errorMessage.includes('gas')) {
            showNotification('Insufficient funds for gas fees.', 'error');
        } else if (errorMessage.includes('network')) {
            showNotification('Network error. Please check your connection and try again.', 'error');
        } else {
            showNotification('Fee collection failed. Please try again.', 'error');
        }
        
    } finally {
        // Reset UI elements
        loading.style.display = 'none';
        btnText.textContent = `Collect ${tokenType === 'rayverse' ? 'RAY' : 'STK'} Fees`;
    }
}

        // Format number with commas
        function formatNumber(num) {
            return parseFloat(num).toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 4
            });
        }

        // Auto-refresh data every 30 seconds
        setInterval(() => {
            if (contract && userAddress) {
                updateAllData();
            }
        }, 30000);

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            createParticles();
            
            // Add test balance button for development
            const header = document.querySelector('.header');
            const testBtn = document.createElement('button');
            testBtn.textContent = 'Get Test Tokens';
            testBtn.className = 'wallet-connect';
            testBtn.style.marginLeft = '10px';
            testBtn.onclick = getSomeBalance;
            header.appendChild(testBtn);

            // Auto-connect if wallet was previously connected
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.request({ method: 'eth_accounts' })
                    .then(accounts => {
                        if (accounts.length > 0) {
                            connectWallet();
                        }
                    });
            }

            // Listen for account changes
            if (typeof window.ethereum !== 'undefined') {
                window.ethereum.on('accountsChanged', function (accounts) {
                    if (accounts.length === 0) {
                        // User disconnected
                        document.getElementById('wallet-text').textContent = 'Connect Wallet';
                        provider = null;
                        signer = null;
                        contract = null;
                        userAddress = null;
                    } else {
                        // User switched accounts
                        connectWallet();
                    }
                });

                window.ethereum.on('chainChanged', function (chainId) {
                    // Reload the page when chain changes
                    window.location.reload();
                });
            }
        });

        // Enhanced animations
        document.querySelectorAll('.input-field').forEach(input => {
            input.addEventListener('focus', function() {
                this.parentElement.style.transform = 'scale(1.02)';
            });
            
            input.addEventListener('blur', function() {
                this.parentElement.style.transform = 'scale(1)';
            });
        });

        // Smooth scroll for mobile
        document.querySelectorAll('input[type="number"]').forEach(input => {
            input.addEventListener('input', function() {
                this.style.background = this.value ? 
                    'rgba(102, 126, 234, 0.1)' : 
                    'rgba(255, 255, 255, 0.1)';
            });
        });

        // Add ripple effect to buttons
        document.querySelectorAll('.btn').forEach(btn => {
            btn.addEventListener('click', function(e) {
                const ripple = document.createElement('span');
                const rect = this.getBoundingClientRect();
                const size = Math.max(rect.width, rect.height);
                const x = e.clientX - rect.left - size / 2;
                const y = e.clientY - rect.top - size / 2;
                
                ripple.style.width = ripple.style.height = size + 'px';
                ripple.style.left = x + 'px';
                ripple.style.top = y + 'px';
                ripple.classList.add('ripple');
                
                this.appendChild(ripple);
                
                setTimeout(() => {
                    ripple.remove();
                }, 600);
            });
        });

        // Add floating animation to cards
        document.querySelectorAll('.card').forEach((card, index) => {
            card.style.animationDelay = `${index * 0.1}s`;
            card.style.animation = 'fadeInUp 0.6s ease forwards';
        });

        // CSS for animations
        const style = document.createElement('style');
        style.textContent = `
            .ripple {
                position: absolute;
                border-radius: 50%;
                background: rgba(255, 255, 255, 0.6);
                transform: scale(0);
                animation: rippleEffect 0.6s linear;
                pointer-events: none;
            }
            
            @keyframes rippleEffect {
                to {
                    transform: scale(4);
                    opacity: 0;
                }
            }
            
            @keyframes fadeInUp {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }
            
            .card {
                opacity: 0;
            }
            
            .notification.error {
                background: linear-gradient(135deg, #ff6b6b 0%, #ee5a24 100%);
            }
            
            .notification.success {
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            }
        `;
        document.head.appendChild(style);
    </script>
</body>
</html>